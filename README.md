# hm-dianping

### Redis主从
#### 1、安装
在从节点配置文件中增加slaveof或者replicaof masterIp masterPort 即可
#### 2、主从同步
##### 2.1、全量同步
当从节点第一次请求主节点同步数据时会发生全量同步，主节点会将内存中数据刷到RDB文件中，通过文件拷贝或者网络io传输RDB文件，从节点加载该RDB文件
##### 2.2、增量同步
从节点请求数据同步会携带replicaId和offset参数，主节点会将offset之后的记录传输给从节点，从节点收到更新命令后执行更新
##### 2.3、区别
全量使用RDB通过拷贝或者网络io流传输到从节点，从节点flush已有的数据并load新的RDB文件到自己内存中； 增量同步是从节点请求主节点进行同步，请求时带上replicaId和offset，主节点将repl_baklog中offset之后的命令传输给从节点，此外当
从节点因为其他原因offset被覆盖，则需要进行全量同步
#### 3、优化
##### 3.1.尽量避免全量同步 
##### 3.2.当磁盘io较慢或者网络带宽较大时，可以设置通过网络io进行全量同步 
##### 3.3存在多个从节点时，可以采用主-从-从的方式减轻主节点同步时的压力 
##### 3.4.可适当增大repl_baklog的大小，避免从节点的offset较容易被覆盖，从而产生全量同步

### Redis-cluster